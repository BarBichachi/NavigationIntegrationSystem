<?xml version="1.0" encoding="utf-8" ?>
<Page x:Class="NavigationIntegrationSystem.UI.Views.Pages.LogsPage" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:logging="using:NavigationIntegrationSystem.UI.Services.Logging"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" mc:Ignorable="d">

    <Grid Padding="16" KeyboardAcceleratorPlacementMode="Hidden" RowSpacing="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <!--  Keyboard Accelerators  -->
        <Grid.KeyboardAccelerators>
            <KeyboardAccelerator Key="C" Invoked="OnCopyAcceleratorInvoked" Modifiers="Control" />
            <KeyboardAccelerator Key="A" Invoked="OnSelectAllAcceleratorInvoked" Modifiers="Control" />
            <KeyboardAccelerator Key="Delete" Invoked="OnDeleteAcceleratorInvoked" />
            <KeyboardAccelerator Key="Escape" Invoked="OnEscapeAcceleratorInvoked" />
        </Grid.KeyboardAccelerators>

        <!--  Header  -->
        <TextBlock FontSize="28" FontWeight="SemiBold" Text="Logs" />

        <!--  Filters + Actions (same row)  -->
        <Grid Grid.Row="1" VerticalAlignment="Center" ColumnSpacing="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="360" />
                <ColumnDefinition Width="80" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="120" />
                <ColumnDefinition Width="120" />
                <ColumnDefinition Width="120" />
            </Grid.ColumnDefinitions>
            <!--  Left: filters  -->
            <TextBox Grid.Column="0" Width="360" PlaceholderText="Search..." Text="{x:Bind ViewModel.SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
            <ComboBox Grid.Column="1" Width="80" SelectedValue="{x:Bind ViewModel.SelectedLevel, Mode=TwoWay}" SelectedValuePath="Content">
                <ComboBoxItem Content="All" />
                <ComboBoxItem Content="DEBUG" />
                <ComboBoxItem Content="INFO" />
                <ComboBoxItem Content="WARN" />
                <ComboBoxItem Content="ERROR" />
            </ComboBox>

            <!--  Column 3 is the flexible spacer (*)  -->

            <!--  Right: actions  -->
            <Button Grid.Column="3" Width="120" Command="{x:Bind ViewModel.CopyCommand}" CommandParameter="{x:Bind ViewModel.SelectedItems, Mode=OneWay}" Content="{x:Bind ViewModel.CopyButtonText, Mode=OneWay}" />
            <Button Grid.Column="4" Width="120" Command="{x:Bind ViewModel.ClearCommand}" CommandParameter="{x:Bind ViewModel.SelectedItems, Mode=OneWay}" Content="{x:Bind ViewModel.ClearButtonText, Mode=OneWay}" />
            <Button Grid.Column="5" Width="120" Command="{x:Bind ViewModel.ToggleSelectAllCommand}" CommandParameter="{Binding ElementName=LogsList}" Content="{x:Bind ViewModel.SelectAllButtonText}" />
        </Grid>

        <!--  Log list container  -->
        <Border Grid.Row="2" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="12">
            <ListView x:Name="LogsList" Padding="8" ItemsSource="{x:Bind ViewModel.FilteredEntries, Mode=OneWay}" SelectionChanged="OnLogsSelectionChanged" SelectionMode="Multiple">
                <!--  Log entry template  -->
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="logging:UiLogEntry">
                        <Grid Padding="8" VerticalAlignment="Center" ColumnSpacing="16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" VerticalAlignment="Center" FontFamily="Consolas" Opacity="0.75" Text="{x:Bind TimestampText}" />
                            <TextBlock Grid.Column="1" VerticalAlignment="Center" FontFamily="Consolas" FontWeight="SemiBold"
                                       Foreground="{x:Bind Level, Converter={StaticResource LogLevelToBrushConverter}}"
                                       Text="{x:Bind Level}" />
                            <TextBlock Grid.Column="2" VerticalAlignment="Center" Text="{x:Bind Message}" TextWrapping="WrapWholeWords" />

                            <Rectangle Grid.ColumnSpan="3" Height="1" VerticalAlignment="Bottom" Fill="{ThemeResource CardStrokeColorDefaultBrush}" Opacity="0.25" />
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Border>

        <!--  Footer  -->
        <Grid Grid.Row="3" VerticalAlignment="Center">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <TextBlock VerticalAlignment="Center" Opacity="0.7" Text="{x:Bind ViewModel.LogFolderPath, Mode=OneWay}" />
            <HyperlinkButton Grid.Column="1" Command="{x:Bind ViewModel.OpenLogFolderCommand}" Content="Open logs folder" />
        </Grid>
    </Grid>
</Page>
